{
    "sourceFile": "src/pages/dashboard/users.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 12,
            "patches": [
                {
                    "date": 1748387883099,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1749320524381,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n     CardHeader,\r\n     CardBody,\r\n     Typography,\r\n } from \"@material-tailwind/react\";\r\n-import { useEffect, useState } from \"react\";\r\n+import { useContext, useEffect, useState } from \"react\";\r\n import client from \"../../api/client\";\r\n import {\r\n     DocumentTextIcon,\r\n     FolderOpenIcon,\r\n@@ -16,10 +16,12 @@\n import ConstatModal from \"@/components/ConstatModal\";\r\n import AddUsersModal from \"../../components/AddUsersModal\";\r\n import { ToastContainer, toast } from 'react-toastify';\r\n import 'react-toastify/dist/ReactToastify.css';\r\n+import AuthContext from \"@/auth/context\";\r\n \r\n export function Users() {\r\n+     const { admin } = useContext(AuthContext);\r\n     const [users, setUsers] = useState([]);\r\n     const [search, setSearch] = useState(\"\");\r\n     const [currentPage, setCurrentPage] = useState(1);\r\n     const usersPerPage = 5;\r\n"
                },
                {
                    "date": 1749320746395,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,8 +9,10 @@\n import {\r\n     DocumentTextIcon,\r\n     FolderOpenIcon,\r\n     TruckIcon,\r\n+    TrashIcon\r\n+    \r\n } from \"@heroicons/react/24/outline\";\r\n import VehiculeModal from \"../../components/VehiculeModal\";\r\n import DocumentModal from \"@/components/DocumentModal\";\r\n import ConstatModal from \"@/components/ConstatModal\";\r\n@@ -251,8 +253,21 @@\n                                                     >\r\n                                                         <TruckIcon className=\"h-4 w-4\" />\r\n                                                         Véhicules\r\n                                                     </button>\r\n+                                                    {\r\n+                                                        admin.role===\"Admin\" && (\r\n+                                                               <button\r\n+                                                        onClick={() => {\r\n+                                                          \r\n+                                                        }}\r\n+                                                        className=\"flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n+                                                    >\r\n+                                                        <TrashIcon className=\"h-4 w-4\" />\r\n+                                                        supprimer\r\n+                                                    </button>\r\n+                                                        )\r\n+                                                    }\r\n                                                 </div>\r\n                                             </td>\r\n                                         </tr>\r\n                                     );\r\n"
                },
                {
                    "date": 1749320775646,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -262,9 +262,9 @@\n                                                         }}\r\n                                                         className=\"flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n                                                     >\r\n                                                         <TrashIcon className=\"h-4 w-4\" />\r\n-                                                        supprimer\r\n+                                                     \r\n                                                     </button>\r\n                                                         )\r\n                                                     }\r\n                                                 </div>\r\n"
                },
                {
                    "date": 1749320898241,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -217,59 +217,56 @@\n                                                 <Typography className=\"text-xs font-semibold text-blue-gray-600\">\r\n                                                     {vehicules?.length}\r\n                                                 </Typography>\r\n                                             </td>\r\n-                                            <td className={className}>\r\n-                                                <div className=\"flex flex-wrap gap-2\">\r\n-                                                    <button\r\n-                                                        onClick={() => {\r\n-                                                            setSelectedUserId({ _id, name, prenom });\r\n-                                                            setOpenConstatModal(true);\r\n-                                                        }}\r\n-                                                        className=\"flex items-center gap-1 bg-blue-500 hover:bg-blue-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n-                                                    >\r\n-                                                        <DocumentTextIcon className=\"h-4 w-4\" />\r\n-                                                        Constat\r\n-                                                    </button>\r\n-                                                    <button\r\n-                                                        onClick={() =>\r\n-                                                            handleOpenDocumentModal({\r\n-                                                                numeroPermis: numeroPermis,\r\n-                                                                dateExpiration: dateExpiration,\r\n-                                                                dateDelivrance: dateDelivrance,\r\n-                                                                categoriesPermis: categoriesPermis\r\n-                                                            })\r\n-                                                        }\r\n-                                                        className=\"flex items-center gap-1 bg-green-500 hover:bg-green-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n-                                                    >\r\n-                                                        <FolderOpenIcon className=\"h-4 w-4\" />\r\n-                                                        Document\r\n-                                                    </button>\r\n-                                                    <button\r\n-                                                        onClick={() => {\r\n-                                                            setSelectedUserId(_id);\r\n-                                                            setModalOpen(true);\r\n-                                                        }}\r\n-                                                        className=\"flex items-center gap-1 bg-purple-500 hover:bg-purple-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n-                                                    >\r\n-                                                        <TruckIcon className=\"h-4 w-4\" />\r\n-                                                        Véhicules\r\n-                                                    </button>\r\n-                                                    {\r\n-                                                        admin.role===\"Admin\" && (\r\n-                                                               <button\r\n-                                                        onClick={() => {\r\n-                                                          \r\n-                                                        }}\r\n-                                                        className=\"flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n-                                                    >\r\n-                                                        <TrashIcon className=\"h-4 w-4\" />\r\n-                                                     \r\n-                                                    </button>\r\n-                                                        )\r\n-                                                    }\r\n-                                                </div>\r\n-                                            </td>\r\n+                                          <td className={className}>\r\n+    <div className=\"flex gap-2\">\r\n+        <button\r\n+            onClick={() => {\r\n+                setSelectedUserId({ _id, name, prenom });\r\n+                setOpenConstatModal(true);\r\n+            }}\r\n+            className=\"flex items-center gap-1 bg-blue-500 hover:bg-blue-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n+        >\r\n+            <DocumentTextIcon className=\"h-4 w-4\" />\r\n+            Constat\r\n+        </button>\r\n+        <button\r\n+            onClick={() =>\r\n+                handleOpenDocumentModal({\r\n+                    numeroPermis: numeroPermis,\r\n+                    dateExpiration: dateExpiration,\r\n+                    dateDelivrance: dateDelivrance,\r\n+                    categoriesPermis: categoriesPermis\r\n+                })\r\n+            }\r\n+            className=\"flex items-center gap-1 bg-green-500 hover:bg-green-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n+        >\r\n+            <FolderOpenIcon className=\"h-4 w-4\" />\r\n+            Document\r\n+        </button>\r\n+        <button\r\n+            onClick={() => {\r\n+                setSelectedUserId(_id);\r\n+                setModalOpen(true);\r\n+            }}\r\n+            className=\"flex items-center gap-1 bg-purple-500 hover:bg-purple-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n+        >\r\n+            <TruckIcon className=\"h-4 w-4\" />\r\n+            Véhicules\r\n+        </button>\r\n+        {admin.role === \"Admin\" && (\r\n+            <button\r\n+                onClick={() => {\r\n+                    // Add your delete logic here\r\n+                }}\r\n+                className=\"flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n+            >\r\n+                <TrashIcon className=\"h-4 w-4\" />\r\n+            </button>\r\n+        )}\r\n+    </div>\r\n+</td>\r\n                                         </tr>\r\n                                     );\r\n                                 }\r\n                             )}\r\n"
                },
                {
                    "date": 1749321103328,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,17 +2,21 @@\n     Card,\r\n     CardHeader,\r\n     CardBody,\r\n     Typography,\r\n+    Dialog,\r\n+    DialogHeader,\r\n+    DialogBody,\r\n+    DialogFooter,\r\n+    Button\r\n } from \"@material-tailwind/react\";\r\n import { useContext, useEffect, useState } from \"react\";\r\n import client from \"../../api/client\";\r\n import {\r\n     DocumentTextIcon,\r\n     FolderOpenIcon,\r\n     TruckIcon,\r\n     TrashIcon\r\n-    \r\n } from \"@heroicons/react/24/outline\";\r\n import VehiculeModal from \"../../components/VehiculeModal\";\r\n import DocumentModal from \"@/components/DocumentModal\";\r\n import ConstatModal from \"@/components/ConstatModal\";\r\n@@ -21,9 +25,9 @@\n import 'react-toastify/dist/ReactToastify.css';\r\n import AuthContext from \"@/auth/context\";\r\n \r\n export function Users() {\r\n-     const { admin } = useContext(AuthContext);\r\n+    const { admin } = useContext(AuthContext);\r\n     const [users, setUsers] = useState([]);\r\n     const [search, setSearch] = useState(\"\");\r\n     const [currentPage, setCurrentPage] = useState(1);\r\n     const usersPerPage = 5;\r\n@@ -32,8 +36,10 @@\n     const [openConstatModal, setOpenConstatModal] = useState(false);\r\n     const [selectedUserId, setSelectedUserId] = useState(null);\r\n     const [openDocumentModal, setOpenDocumentModal] = useState(false);\r\n     const [selectedDocument, setSelectedDocument] = useState(null);\r\n+    const [openConfirmDeleteModal, setOpenConfirmDeleteModal] = useState(false);\r\n+    const [userToDelete, setUserToDelete] = useState(null);\r\n \r\n     const fetchUsers = async () => {\r\n         try {\r\n             const res = await client.get(\"/users/allUsers\");\r\n@@ -54,8 +60,27 @@\n     const handleVehicleAdded = () => {\r\n         fetchUsers(); // Refresh the users list to update vehicles\r\n     };\r\n \r\n+    const handleDeleteUser = async () => {\r\n+        try {\r\n+            const response = await client.delete(`/users/deleteUser/${userToDelete._id}`);\r\n+            toast.success(\"Assuré supprimé avec succès.\", {\r\n+                position: \"top-right\",\r\n+                autoClose: 3000,\r\n+            });\r\n+            fetchUsers();\r\n+            setOpenConfirmDeleteModal(false);\r\n+            setUserToDelete(null);\r\n+        } catch (error) {\r\n+            console.error(\"Error deleting user:\", error);\r\n+            toast.error(\"Erreur lors de la suppression de l'assuré.\", {\r\n+                position: \"top-right\",\r\n+                autoClose: 3000,\r\n+            });\r\n+        }\r\n+    };\r\n+\r\n     const filteredUsers = users.filter((user) =>\r\n         user.cin.toLowerCase().includes(search.toLowerCase())\r\n     );\r\n \r\n@@ -217,56 +242,57 @@\n                                                 <Typography className=\"text-xs font-semibold text-blue-gray-600\">\r\n                                                     {vehicules?.length}\r\n                                                 </Typography>\r\n                                             </td>\r\n-                                          <td className={className}>\r\n-    <div className=\"flex gap-2\">\r\n-        <button\r\n-            onClick={() => {\r\n-                setSelectedUserId({ _id, name, prenom });\r\n-                setOpenConstatModal(true);\r\n-            }}\r\n-            className=\"flex items-center gap-1 bg-blue-500 hover:bg-blue-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n-        >\r\n-            <DocumentTextIcon className=\"h-4 w-4\" />\r\n-            Constat\r\n-        </button>\r\n-        <button\r\n-            onClick={() =>\r\n-                handleOpenDocumentModal({\r\n-                    numeroPermis: numeroPermis,\r\n-                    dateExpiration: dateExpiration,\r\n-                    dateDelivrance: dateDelivrance,\r\n-                    categoriesPermis: categoriesPermis\r\n-                })\r\n-            }\r\n-            className=\"flex items-center gap-1 bg-green-500 hover:bg-green-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n-        >\r\n-            <FolderOpenIcon className=\"h-4 w-4\" />\r\n-            Document\r\n-        </button>\r\n-        <button\r\n-            onClick={() => {\r\n-                setSelectedUserId(_id);\r\n-                setModalOpen(true);\r\n-            }}\r\n-            className=\"flex items-center gap-1 bg-purple-500 hover:bg-purple-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n-        >\r\n-            <TruckIcon className=\"h-4 w-4\" />\r\n-            Véhicules\r\n-        </button>\r\n-        {admin.role === \"Admin\" && (\r\n-            <button\r\n-                onClick={() => {\r\n-                    // Add your delete logic here\r\n-                }}\r\n-                className=\"flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n-            >\r\n-                <TrashIcon className=\"h-4 w-4\" />\r\n-            </button>\r\n-        )}\r\n-    </div>\r\n-</td>\r\n+                                            <td className={className}>\r\n+                                                <div className=\"flex gap-2\">\r\n+                                                    <button\r\n+                                                        onClick={() => {\r\n+                                                            setSelectedUserId({ _id, name, prenom });\r\n+                                                            setOpenConstatModal(true);\r\n+                                                        }}\r\n+                                                        className=\"flex items-center gap-1 bg-blue-500 hover:bg-blue-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n+                                                    >\r\n+                                                        <DocumentTextIcon className=\"h-4 w-4\" />\r\n+                                                        Constat\r\n+                                                    </button>\r\n+                                                    <button\r\n+                                                        onClick={() =>\r\n+                                                            handleOpenDocumentModal({\r\n+                                                                numeroPermis: numeroPermis,\r\n+                                                                dateExpiration: dateExpiration,\r\n+                                                                dateDelivrance: dateDelivrance,\r\n+                                                                categoriesPermis: categoriesPermis\r\n+                                                            })\r\n+                                                        }\r\n+                                                        className=\"flex items-center gap-1 bg-green-500 hover:bg-green-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n+                                                    >\r\n+                                                        <FolderOpenIcon className=\"h-4 w-4\" />\r\n+                                                        Document\r\n+                                                    </button>\r\n+                                                    <button\r\n+                                                        onClick={() => {\r\n+                                                            setSelectedUserId(_id);\r\n+                                                            setModalOpen(true);\r\n+                                                        }}\r\n+                                                        className=\"flex items-center gap-1 bg-purple-500 hover:bg-purple-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n+                                                    >\r\n+                                                        <TruckIcon className=\"h-4 w-4\" />\r\n+                                                        Véhicules\r\n+                                                    </button>\r\n+                                                    {admin.role === \"Admin\" && (\r\n+                                                        <button\r\n+                                                            onClick={() => {\r\n+                                                                setUserToDelete({ _id, name, prenom });\r\n+                                                                setOpenConfirmDeleteModal(true);\r\n+                                                            }}\r\n+                                                            className=\"flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n+                                                        >\r\n+                                                            <TrashIcon className=\"h-4 w-4\" />\r\n+                                                        </button>\r\n+                                                    )}\r\n+                                                </div>\r\n+                                            </td>\r\n                                         </tr>\r\n                                     );\r\n                                 }\r\n                             )}\r\n@@ -313,8 +339,34 @@\n                 open={openModal}\r\n                 handleClose={() => setOpenModal(false)}\r\n                 onUserAdded={handleUserAdded}\r\n             />\r\n+            <Dialog open={openConfirmDeleteModal} handler={() => setOpenConfirmDeleteModal(false)}>\r\n+                <DialogHeader>Confirmer la suppression</DialogHeader>\r\n+                <DialogBody>\r\n+                    Êtes-vous sûr de vouloir supprimer l'assuré {userToDelete?.name} {userToDelete?.prenom} ? Cette action est irréversible.\r\n+                </DialogBody>\r\n+                <DialogFooter>\r\n+                    <Button\r\n+                        variant=\"text\"\r\n+                        color=\"blue-gray\"\r\n+                        onClick={() => {\r\n+                            setOpenConfirmDeleteModal(false);\r\n+                            setUserToDelete(null);\r\n+                        }}\r\n+                        className=\"mr-1\"\r\n+                    >\r\n+                        Annuler\r\n+                    </Button>\r\n+                    <Button\r\n+                        variant=\"gradient\"\r\n+                        color=\"red\"\r\n+                        onClick={handleDeleteUser}\r\n+                    >\r\n+                        Supprimer\r\n+                    </Button>\r\n+                </DialogFooter>\r\n+            </Dialog>\r\n         </div>\r\n     );\r\n }\r\n \r\n"
                },
                {
                    "date": 1749321161815,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -342,9 +342,9 @@\n             />\r\n             <Dialog open={openConfirmDeleteModal} handler={() => setOpenConfirmDeleteModal(false)}>\r\n                 <DialogHeader>Confirmer la suppression</DialogHeader>\r\n                 <DialogBody>\r\n-                    Êtes-vous sûr de vouloir supprimer l'assuré {userToDelete?.name} {userToDelete?.prenom} ? Cette action est irréversible.\r\n+                    Êtes-vous sûr de vouloir supprimer l'assuré {userToDelete?.name} {userToDelete?.prenom} ???\r\n                 </DialogBody>\r\n                 <DialogFooter>\r\n                     <Button\r\n                         variant=\"text\"\r\n"
                },
                {
                    "date": 1749321299802,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -60,26 +60,28 @@\n     const handleVehicleAdded = () => {\r\n         fetchUsers(); // Refresh the users list to update vehicles\r\n     };\r\n \r\n-    const handleDeleteUser = async () => {\r\n-        try {\r\n-            const response = await client.delete(`/users/deleteUser/${userToDelete._id}`);\r\n-            toast.success(\"Assuré supprimé avec succès.\", {\r\n-                position: \"top-right\",\r\n-                autoClose: 3000,\r\n-            });\r\n-            fetchUsers();\r\n-            setOpenConfirmDeleteModal(false);\r\n-            setUserToDelete(null);\r\n-        } catch (error) {\r\n-            console.error(\"Error deleting user:\", error);\r\n-            toast.error(\"Erreur lors de la suppression de l'assuré.\", {\r\n-                position: \"top-right\",\r\n-                autoClose: 3000,\r\n-            });\r\n-        }\r\n-    };\r\n+   const handleDeleteUser = async () => {\r\n+    try {\r\n+        const response = await client.delete(\"/users/user\", {\r\n+            data: { idUser: userToDelete._id }\r\n+        });\r\n+        toast.success(\"Assuré supprimé avec succès.\", {\r\n+            position: \"top-right\",\r\n+            autoClose: 3000,\r\n+        });\r\n+        fetchUsers();\r\n+        setOpenConfirmDeleteModal(false);\r\n+        setUserToDelete(null);\r\n+    } catch (error) {\r\n+        console.error(\"Error deleting user:\", error);\r\n+        toast.error(\"Erreur lors de la suppression de l'assuré.\", {\r\n+            position: \"top-right\",\r\n+            autoClose: 3000,\r\n+        });\r\n+    }\r\n+};\r\n \r\n     const filteredUsers = users.filter((user) =>\r\n         user.cin.toLowerCase().includes(search.toLowerCase())\r\n     );\r\n"
                },
                {
                    "date": 1749321391354,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -60,12 +60,13 @@\n     const handleVehicleAdded = () => {\r\n         fetchUsers(); // Refresh the users list to update vehicles\r\n     };\r\n \r\n+\r\n    const handleDeleteUser = async () => {\r\n     try {\r\n         const response = await client.delete(\"/users/user\", {\r\n-            data: { idUser: userToDelete._id }\r\n+             idUser: userToDelete._id \r\n         });\r\n         toast.success(\"Assuré supprimé avec succès.\", {\r\n             position: \"top-right\",\r\n             autoClose: 3000,\r\n"
                },
                {
                    "date": 1749321597521,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -61,12 +61,12 @@\n         fetchUsers(); // Refresh the users list to update vehicles\r\n     };\r\n \r\n \r\n-   const handleDeleteUser = async () => {\r\n+const handleDeleteUser = async () => {\r\n     try {\r\n         const response = await client.delete(\"/users/user\", {\r\n-             idUser: userToDelete._id \r\n+            data: { idUser: userToDelete._id }\r\n         });\r\n         toast.success(\"Assuré supprimé avec succès.\", {\r\n             position: \"top-right\",\r\n             autoClose: 3000,\r\n"
                },
                {
                    "date": 1749321797290,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,9 +63,9 @@\n \r\n \r\n const handleDeleteUser = async () => {\r\n     try {\r\n-        const response = await client.delete(\"/users/user\", {\r\n+        const response = await client.post(\"/users/deleteUser\", {\r\n             data: { idUser: userToDelete._id }\r\n         });\r\n         toast.success(\"Assuré supprimé avec succès.\", {\r\n             position: \"top-right\",\r\n"
                },
                {
                    "date": 1749322000896,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -64,9 +64,9 @@\n \r\n const handleDeleteUser = async () => {\r\n     try {\r\n         const response = await client.post(\"/users/deleteUser\", {\r\n-            data: { idUser: userToDelete._id }\r\n+            idUser: userToDelete._id\r\n         });\r\n         toast.success(\"Assuré supprimé avec succès.\", {\r\n             position: \"top-right\",\r\n             autoClose: 3000,\r\n"
                },
                {
                    "date": 1749328162903,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -154,14 +154,17 @@\n                                 setSearch(e.target.value);\r\n                                 setCurrentPage(1);\r\n                             }}\r\n                         />\r\n-                        <button\r\n+                           {admin.role === \"Admin\" && (\r\n+                              <button\r\n                             className=\"bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded-md\"\r\n                             onClick={() => setOpenModal(true)}\r\n                         >\r\n                             Ajouter Assuré\r\n                         </button>\r\n+                           )}\r\n+                      \r\n                     </div>\r\n                 </CardHeader>\r\n                 <CardBody className=\"overflow-x-scroll px-0 pt-0 pb-2\">\r\n                     <table className=\"w-full min-w-[640px] table-auto\">\r\n"
                }
            ],
            "date": 1748387883099,
            "name": "Commit-0",
            "content": "import {\r\n    Card,\r\n    CardHeader,\r\n    CardBody,\r\n    Typography,\r\n} from \"@material-tailwind/react\";\r\nimport { useEffect, useState } from \"react\";\r\nimport client from \"../../api/client\";\r\nimport {\r\n    DocumentTextIcon,\r\n    FolderOpenIcon,\r\n    TruckIcon,\r\n} from \"@heroicons/react/24/outline\";\r\nimport VehiculeModal from \"../../components/VehiculeModal\";\r\nimport DocumentModal from \"@/components/DocumentModal\";\r\nimport ConstatModal from \"@/components/ConstatModal\";\r\nimport AddUsersModal from \"../../components/AddUsersModal\";\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\n\r\nexport function Users() {\r\n    const [users, setUsers] = useState([]);\r\n    const [search, setSearch] = useState(\"\");\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const usersPerPage = 5;\r\n    const [modalOpen, setModalOpen] = useState(false);\r\n    const [openModal, setOpenModal] = useState(false);\r\n    const [openConstatModal, setOpenConstatModal] = useState(false);\r\n    const [selectedUserId, setSelectedUserId] = useState(null);\r\n    const [openDocumentModal, setOpenDocumentModal] = useState(false);\r\n    const [selectedDocument, setSelectedDocument] = useState(null);\r\n\r\n    const fetchUsers = async () => {\r\n        try {\r\n            const res = await client.get(\"/users/allUsers\");\r\n            setUsers(res.data);\r\n        } catch (error) {\r\n            console.error(\"Error fetching users:\", error);\r\n            toast.error(\"Erreur lors du chargement des utilisateurs.\", {\r\n                position: \"top-right\",\r\n                autoClose: 3000,\r\n            });\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchUsers();\r\n    }, []);\r\n\r\n    const handleVehicleAdded = () => {\r\n        fetchUsers(); // Refresh the users list to update vehicles\r\n    };\r\n\r\n    const filteredUsers = users.filter((user) =>\r\n        user.cin.toLowerCase().includes(search.toLowerCase())\r\n    );\r\n\r\n    const indexOfLastUser = currentPage * usersPerPage;\r\n    const indexOfFirstUser = indexOfLastUser - usersPerPage;\r\n    const currentUsers = filteredUsers.slice(indexOfFirstUser, indexOfLastUser);\r\n    const totalPages = Math.ceil(filteredUsers.length / usersPerPage);\r\n\r\n    const handleOpenDocumentModal = (user) => {\r\n        setSelectedDocument(user);\r\n        setOpenDocumentModal(true);\r\n    };\r\n\r\n    const handleUserAdded = async (userData, resetModal) => {\r\n        try {\r\n            let response = await client.post(\"/users/addUser\", userData);\r\n            if (response.status === 400) {\r\n                toast.error(response?.data?.message, {\r\n                    position: \"top-right\",\r\n                    autoClose: 3000,\r\n                    hideProgressBar: false,\r\n                    closeOnClick: true,\r\n                    pauseOnHover: true,\r\n                    draggable: true,\r\n                    progress: undefined,\r\n                });\r\n            } else {\r\n                toast.success(response?.data?.message, {\r\n                    position: \"top-right\",\r\n                    autoClose: 3000,\r\n                    hideProgressBar: false,\r\n                    closeOnClick: true,\r\n                    pauseOnHover: true,\r\n                    draggable: true,\r\n                    progress: undefined,\r\n                });\r\n                fetchUsers();\r\n                resetModal();\r\n                setOpenModal(false);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error adding user:\", error);\r\n            toast.error(\"Erreur lors de l'ajout de l'utilisateur.\", {\r\n                position: \"top-right\",\r\n                autoClose: 3000,\r\n            });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"mt-12 mb-8 flex flex-col gap-12\">\r\n            <ToastContainer position=\"top-center\" />\r\n            <Card>\r\n                <CardHeader\r\n                    variant=\"gradient\"\r\n                    color=\"gray\"\r\n                    className=\"mb-8 p-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4\"\r\n                >\r\n                    <Typography variant=\"h6\" color=\"white\">\r\n                        Liste des assurés\r\n                    </Typography>\r\n                    <div className=\"flex flex-col md:flex-row items-center gap-4 w-full md:w-auto\">\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Rechercher par CIN...\"\r\n                            className=\"px-3 py-2 rounded-md text-sm text-gray-800 w-full md:w-64\"\r\n                            onChange={(e) => {\r\n                                setSearch(e.target.value);\r\n                                setCurrentPage(1);\r\n                            }}\r\n                        />\r\n                        <button\r\n                            className=\"bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded-md\"\r\n                            onClick={() => setOpenModal(true)}\r\n                        >\r\n                            Ajouter Assuré\r\n                        </button>\r\n                    </div>\r\n                </CardHeader>\r\n                <CardBody className=\"overflow-x-scroll px-0 pt-0 pb-2\">\r\n                    <table className=\"w-full min-w-[640px] table-auto\">\r\n                        <thead>\r\n                            <tr>\r\n                                {[\"Nom\", \"Prenom\", \"CIN\", \"N° Telephone\", \"N° Permis\", \"Cat Permis\", \"Véhicule\", \"Actions\"].map((el) => (\r\n                                    <th key={el} className=\"border-b border-blue-gray-50 py-3 px-5 text-center\">\r\n                                        <Typography\r\n                                            variant=\"small\"\r\n                                            className=\"text-[11px] font-bold uppercase text-blue-gray-400\"\r\n                                        >\r\n                                            {el}\r\n                                        </Typography>\r\n                                    </th>\r\n                                ))}\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {currentUsers.map(\r\n                                ({ _id, name, prenom, cin, numeroTelephone, numeroPermis, categoriesPermis, vehicules, dateDelivrance, dateExpiration }, key) => {\r\n                                    const className = `py-3 px-5 border-b border-blue-gray-50`;\r\n\r\n                                    return (\r\n                                        <tr key={_id}>\r\n                                            <td className={className}>\r\n                                                <div className=\"flex items-center gap-4\">\r\n                                                    <div\r\n                                                        style={{\r\n                                                            width: 35,\r\n                                                            height: 35,\r\n                                                            borderRadius: \"50%\",\r\n                                                            backgroundColor: \"#007bff\",\r\n                                                            color: \"#fff\",\r\n                                                            display: \"flex\",\r\n                                                            alignItems: \"center\",\r\n                                                            justifyContent: \"center\",\r\n                                                            fontWeight: \"bold\",\r\n                                                            fontSize: 14,\r\n                                                        }}\r\n                                                    >\r\n                                                        {name?.charAt(0).toUpperCase()}\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <Typography variant=\"small\" color=\"blue-gray\" className=\"font-semibold\">\r\n                                                            {name}\r\n                                                        </Typography>\r\n                                                        <Typography className=\"text-xs font-normal text-blue-gray-500\">\r\n                                                            {prenom}\r\n                                                        </Typography>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className={className}>\r\n                                                <Typography className=\"text-xs font-semibold text-blue-gray-600\">\r\n                                                    {prenom}\r\n                                                </Typography>\r\n                                            </td>\r\n                                            <td className={className}>\r\n                                                <Typography className=\"text-xs font-semibold text-blue-gray-600\">\r\n                                                    {cin}\r\n                                                </Typography>\r\n                                            </td>\r\n                                            <td className={className}>\r\n                                                <Typography className=\"text-xs font-semibold text-blue-gray-600\">\r\n                                                    {numeroTelephone}\r\n                                                </Typography>\r\n                                            </td>\r\n                                            <td className={className}>\r\n                                                <Typography className=\"text-xs font-semibold text-blue-gray-600\">\r\n                                                    {numeroPermis}\r\n                                                </Typography>\r\n                                            </td>\r\n                                            <td className={className}>\r\n                                                {categoriesPermis?.map((c, index) => (\r\n                                                    <Typography key={index} className=\"text-xs font-semibold text-blue-gray-600\">\r\n                                                        {c}\r\n                                                    </Typography>\r\n                                                ))}\r\n                                            </td>\r\n                                            <td className={className}>\r\n                                                <Typography className=\"text-xs font-semibold text-blue-gray-600\">\r\n                                                    {vehicules?.length}\r\n                                                </Typography>\r\n                                            </td>\r\n                                            <td className={className}>\r\n                                                <div className=\"flex flex-wrap gap-2\">\r\n                                                    <button\r\n                                                        onClick={() => {\r\n                                                            setSelectedUserId({ _id, name, prenom });\r\n                                                            setOpenConstatModal(true);\r\n                                                        }}\r\n                                                        className=\"flex items-center gap-1 bg-blue-500 hover:bg-blue-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n                                                    >\r\n                                                        <DocumentTextIcon className=\"h-4 w-4\" />\r\n                                                        Constat\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() =>\r\n                                                            handleOpenDocumentModal({\r\n                                                                numeroPermis: numeroPermis,\r\n                                                                dateExpiration: dateExpiration,\r\n                                                                dateDelivrance: dateDelivrance,\r\n                                                                categoriesPermis: categoriesPermis\r\n                                                            })\r\n                                                        }\r\n                                                        className=\"flex items-center gap-1 bg-green-500 hover:bg-green-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n                                                    >\r\n                                                        <FolderOpenIcon className=\"h-4 w-4\" />\r\n                                                        Document\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => {\r\n                                                            setSelectedUserId(_id);\r\n                                                            setModalOpen(true);\r\n                                                        }}\r\n                                                        className=\"flex items-center gap-1 bg-purple-500 hover:bg-purple-600 text-white text-xs font-medium px-3 py-1.5 rounded-lg shadow-sm transition\"\r\n                                                    >\r\n                                                        <TruckIcon className=\"h-4 w-4\" />\r\n                                                        Véhicules\r\n                                                    </button>\r\n                                                </div>\r\n                                            </td>\r\n                                        </tr>\r\n                                    );\r\n                                }\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                    <div className=\"flex justify-center items-center mt-6 gap-2\">\r\n                        <button\r\n                            onClick={() => setCurrentPage((prev) => Math.max(prev - 1, 1))}\r\n                            disabled={currentPage === 1}\r\n                            className=\"px-3 py-1 text-sm bg-gray-200 rounded disabled:opacity-50\"\r\n                        >\r\n                            Précédent\r\n                        </button>\r\n                        <span className=\"text-sm font-medium\">\r\n                            Page {currentPage} / {totalPages}\r\n                        </span>\r\n                        <button\r\n                            onClick={() => setCurrentPage((prev) => Math.min(prev + 1, totalPages))}\r\n                            disabled={currentPage === totalPages}\r\n                            className=\"px-3 py-1 text-sm bg-gray-200 rounded disabled:opacity-50\"\r\n                        >\r\n                            Suivant\r\n                        </button>\r\n                    </div>\r\n                </CardBody>\r\n            </Card>\r\n            <VehiculeModal\r\n                open={modalOpen}\r\n                onClose={() => setModalOpen(false)}\r\n                userId={selectedUserId}\r\n                onVehicleAdded={handleVehicleAdded}\r\n            />\r\n            <DocumentModal\r\n                isOpen={openDocumentModal}\r\n                onClose={() => setOpenDocumentModal(false)}\r\n                data={selectedDocument}\r\n            />\r\n            <ConstatModal\r\n                open={openConstatModal}\r\n                onClose={() => setOpenConstatModal(false)}\r\n                userId={selectedUserId}\r\n            />\r\n            <AddUsersModal\r\n                open={openModal}\r\n                handleClose={() => setOpenModal(false)}\r\n                onUserAdded={handleUserAdded}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Users;"
        }
    ]
}